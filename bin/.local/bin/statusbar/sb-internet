#!/bin/sh

# Show wifi ğŸ“¶ and percent strength or ğŸ“¡ if none.
# Show ó°Œ˜ if connected to ethernet or â if none.
# Show ğŸ”’ if a vpn connection is active

# case $BLOCK_BUTTON in
# 1)
# 	"$TERMINAL" -e nmtui
# 	pkill -RTMIN+4 dwmblocks
# 	;;
# 3) notify-send "ğŸŒ Internet module" "\- Click to connect
# ó°–ª: no wifi connection
# ï‡«: wifi connection with quality
# â: no ethernet
# ó°Œ˜ : ethernet working
# ğŸ”’: vpn is active
# " ;;
# 6) "$TERMINAL" -e "$EDITOR" "$0" ;;
# esac

# ssid=""
# quality=""
#
# if [ $(cat /sys/class/net/e*/operstate 2>/dev/null) = "up" ]; then
# 	icon="ó°Œ˜ "
# else
# 	if [ $(cat /sys/class/net/w*/operstate 2>/dev/null) = "up" ]; then
# 		ssid=$(nmcli -t -f name connection show --active | head -n 1)
# 		quality="$(awk '/^\s*w/ { print int($3 * 100 / 70) "% " }' /proc/net/wireless)"
# 		icon="ï‡«  "
# 	else
# 		icon="ó°–ª "
# 	fi
# 	# icon="â "
# fi
#
# printf "%s^c#f7ca88^%s%s^d^\n" "$icon" "$quality" "$ssid"

ssid=""
quality=""
icon=""
eth_up=$(ip link show | grep "state UP" | grep "enp")

# Check if any Ethernet interface is connected
if [ "$eth_up" != "" ]; then
    icon="ó°Œ˜ "
else
    # Check if Wi-Fi is connected
    if [ $(cat /sys/class/net/w*/operstate 2>/dev/null) = "up" ]; then
        ssid=$(nmcli -t -f name connection show --active | head -n 1)
        quality="$(awk '/^\s*w/ { print int($3 * 100 / 70) "% " }' /proc/net/wireless)"
        icon="ï‡«  "
    else
        icon="ó°–ª "
    fi
    # icon="â "
fi

printf "%s^c#f7ca88^%s%s^d^\n" "$icon" "$quality" "$ssid"
